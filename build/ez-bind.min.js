/*! ez-bind 2015-02-26 */
!function(){function a(a){this.__listeners=[],a&&this._bind(a)}window.console=window.console||{log:function(){}},document.documentElement.addEventListener||(Element.prototype.addEventListener=function(a,b){this.type&&/(radio|checkbox)/i.test(this.type)&&"change"===a.toLowerCase()?this.attachEvent("onclick",b):this.attachEvent("on"+a,b)}),String.prototype.trim=String.prototype.trim||function(){return this.replace(/^(\s+|\s+)$/g,"")},Array.prototype.indexOf=Array.prototype.indexOf||function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1},a.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a.propertyValue=function(b,c){if(void 0===b)return void 0;var d=a.isArray(c)?c:c.split(/[\.\[\]]+/);return 1===d.length?""===d[0]?b:b[d[0]]:a.propertyValue(b[d[0]],d.slice(1))},a.prototype._get=function(b){return a.propertyValue(this,b)},a.prototype._set=function(b,c){for(var d=b.split(/[\.\[\]]+/),e=d.pop();!e&&d.length;)e=d.pop();var f=d.length>0?a.propertyValue(this,d):this;f[e]=c};var b=function(a,b){this.propertyPath=a,this.listenerFn=b};b.prototype.listen=function(b){var c=!1,d=a.propertyValue(b,this.propertyPath);a.isArray(d)&&(d=d.length);var e=b,f=/^(.*\[\d+\])[^\[\]]+$/.exec(this.propertyPath);return f&&(e=a.propertyValue(b,f[1])),d!==this.oldValue&&(this.listenerFn(d,this.oldValue,e),this.oldValue=a.isArray(d)?d.length:d,c=!0),c},a.prototype._applyChanges=function(){var a=10,b=!1;do{b=!1;for(var c=0;c<this.__listeners.length;c++)b=this.__listeners[c].listen(this)||b;if(b&&!a--)throw"10 applyChanges iterations reached"}while(b)},a.prototype._listen=function(a,c){var d=this,e=/^([^\[\]]+)\[\*\]\.(.*)$/.exec(a);if(e){var f=e[1],g=e[2];d.__listeners.push(new b(f,function(a,e){e=e||0;for(var h=a-e,i=0;h>i;i++)d.__listeners.push(new b(f+"["+(e+i).toString()+"]."+g,c));var j=e-a;for(i=0;j>i;i++)d._unlisten(f+"["+(a+i).toString()+"]."+g)}))}else d.__listeners.push(new b(a,c))},a.prototype._unlisten=function(a){for(var b=this.__listeners.length-1;b>=0;b--)0===this.__listeners[b].propertyPath.indexOf(a)&&this.__listeners.splice(b,1)},a.prototype._apply=function(a){try{return a.call(this)}finally{this._applyChanges()}},a.bindingHandlers={"ez-text":function(a,b,c){a._listen(b,function(a){var b="innerText"in c?"innerText":"textContent";c[b]=a})},"ez-html":function(a,b,c){a._listen(b,function(a){c.innerHTML=a})},"ez-value":function(a,b,c){a._listen(b,function(a){if(void 0!==c.selectedIndex){for(var b=0;b<c.options.length;b++)if(c.options[b].value===a)return void(c.selectedIndex=b)}else c.value=a}),c.addEventListener("change",function(){a._apply(function(){a._set(b,void 0!==c.selectedIndex?c.options[c.selectedIndex].value:c.value)})})},"ez-input":function(a,b,c){a._listen(b,function(a){c.value=a}),c.addEventListener("keydown",function(){a._apply(function(){a._set(b,void 0!==c.selectedIndex?c.options[c.selectedIndex].value:c.value)})})},"ez-class":function(a,b,c){var d=b.trim().split(/\s*\:\s*/);2===d.length&&a._listen(d[1],function(a){if(c.classList)a?c.classList.add(d[0]):c.classList.remove(d[0]);else{var b=c.className.split(/\s+/);if(a)b.push(d[0]);else{var e=b.indexOf(d[0]);e>=0&&b.splice(e,1)}c.className=b.join(" ")}}),1===d.length&&a._listen(b.trim(),function(a,b){if(c.classList)c.classList.remove(b),c.classList.add(a);else{var d=c.className.split(/\s+/),e=d.indexOf(b);e>=0&&d.splice(e,1),d.push(a),c.className=d.join(" ")}})},"ez-checked":function(a,b,c){switch(c.type){case"checkbox":a._listen(b,function(a){c.checked=!!a}),c.addEventListener("change",function(){a._apply(function(){a._set(b,c.checked)})});break;case"radio":a._listen(b,function(a){c.checked=c.value===a}),c.addEventListener("change",function(){a._apply(function(){a._set(b,c.checked?c.value:void 0)})})}},"ez-show":function(a,b,c){var d=c.style.display;a._listen(b,function(a){c.style.display=a?d:"none"})},"ez-style":function(a,b,c){var d=b.trim().split(/\s*\:\s*/);if(2!==d.length)throw"ez-style format: <style-name>:<property-path>";a._listen(d[1],function(a){c.style[d[0]]=a})},"ez-attr":function(a,b,c){var d=b.trim().split(/\s*\:\s*/);if(2!==d.length)throw"ez-attr format: <attr-name>:<property-path>";a._listen(d[1],function(a){c.setAttribute(d[0],a)})},"ez-on":function(a,b,c,d){var e=b.split(/\s*\:\s*/);if(2!==e.length)throw"ez-event format: <event-name> : <func-to-call>";c.addEventListener(e[0],function(b){"function"==typeof a._get(e[1])&&a._apply(function(){a._get(e[1]).call(a,b,d)})})},"ez-repeat":function(a,b,c){var d=c.parentNode,e=d.removeChild(c);e.removeAttribute("ez-repeat"),a._listen(b,function(c,f){f=f||0;for(var g=c-f,h=0;g>h;h++){var i=e.cloneNode(!0);d.appendChild(i),a._bind(i,b+"["+(f+h).toString()+"].")}var j=f-c;for(h=0;j>h;h++)d.removeChild(d.lastChild),a._unlisten(b+"["+(f+h).toString()+"]");return!0})}},a.prototype._bind=function(b,c){if(b){for(var d=0;d<b.attributes.length;d++)for(var e=b.attributes[d],f=e.name.toLowerCase(),g=e.value.trim().split(/\s*\,\s*/),h=0;h<g.length;h++){var i=g[h];if(void 0!==a.bindingHandlers[f]){var j=c||"",k=i.trim().split(/\s*\:\s*/),l=k.length>1?k[0]:"",m=k.length>1?k[1]:k[0],n=j+m,o=/\[(\d+)\][^\[\]]*/.exec(c),p=null!==o?o[1]:void 0;n=n.replace(/\.\.\s*$/,""),n=n.replace(/\w+\[\d+\]\.\s*\^/,""),n=n.replace(/^[^\~]*\~/,"");var q=(l?l+":":"")+n,r=a.bindingHandlers[f](this,q,b,p);if(r)return}else if(0===f.indexOf("ez-"))throw"unknown binding:"+f}for(d=0;d<b.children.length;d++){var s=b.children[d];this._bind(s,c)}}},a.ajax=function(a){a=a||{};var b=a.type||"GET",d=a.url,e=a.contentType||"application/json",f=a.data,g=a.headers||{};"GET"===b||"HEAD"===b?(d+=(-1===d.indexOf("?")?"?":"&")+("object"==typeof f?c(f):f),f=void 0):"object"==typeof f&&(f="application/json"===e?JSON.stringify(f):c(f));var h=new XMLHttpRequest;h.open(b,d,!0),h.setRequestHeader("Content-Type",e);for(var i in g)g.hasOwnProperty(i)&&h.setRequestHeader(i,g[i].toString());return a.beforeSend&&a.beforeSend(h),h.onload=function(){var b=!1,c=h.responseText;if("json"===a.dataType)try{c=JSON.parse(c)}catch(d){b=!0}!a.error||!b&&h.status>=200&&h.status<300?a.success&&a.success(c,h.statusText,h):a.error(h)}.bind(this),h.onerror=h.onabort=function(){a.error&&a.error(h)},h.send(f),h};var c=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};a.prototype._getJsonP=function(a,b,d){var e=this,f="object"==typeof b?b:{};f.callback="callback_"+Math.floor(1e5*Math.random()+1),a+=(-1===a.indexOf("?")?"?":"&")+c(f);var g=document.getElementsByTagName("head")[0],h=document.createElement("script");h.src=a,h.type="text/javascript",window[f.callback]=function(a){e._apply(function(){"function"==typeof b?b(a):d(a)}),setTimeout(function(){try{delete window[f.callback]}catch(a){window[f.callback]=void 0}g.removeChild(h)},0)},g.appendChild(h)},a.prototype._getJson=function(b,c,d){var e=this,f=function(){var a="function"==typeof c?c:d,b=arguments;e._apply(function(){a.apply(e,b)})};a.ajax({url:b,type:"GET",dataType:"json",data:"function"==typeof c?{}:c,success:f})},a.prototype._postJson=function(b,c,d){var e=this,f=function(){var a="function"==typeof c?c:d,b=arguments;e._apply(function(){a.apply(e,b)})};a.ajax({url:b,type:"POST",dataType:"json",data:"function"==typeof c?{}:c,success:f})},"function"==typeof define&&define.amd?define("ez-bind",[],function(){return a}):window.EZ=a}();